<h3>Add Post</h3>

<form id="postForm" name="postForm" ng-submit="data.savePost()" novalidate>
  <div class="post-form-main">
    <fieldset>
        <legend>Post Details</legend>

        <dl class="dl-horizontal">
            <dt><label for="postType">Post Type</label></dt>
            <dd>
                <div id="postType" name="type" class="btn-group">
                    <button name="type"
                            type="button"
                            class="btn btn-default btn-sm"
                            ng-model="data.post.type"
                            btn-radio="'article'">
                        Article
                    </button>
                    <button name="type"
                            type="button"
                            class="btn btn-default btn-sm"
                            ng-model="data.post.type"
                            btn-radio="'video'">
                        Video
                    </button>
                    <button name="type"
                            type="button"
                            class="btn btn-default btn-sm"
                            ng-model="data.post.type"
                            btn-radio="'infographic'">
                        Infographic
                    </button>
                    <button name="type"
                            type="button"
                            class="btn btn-default btn-sm"
                            ng-model="data.post.type"
                            btn-radio="'promo'">
                        Promo
                    </button>
                </div>
                <p ng-show="!data.post.type && postForm.title.$dirty"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove"></span>
                    A post type is required.
                </p>
            </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="postHeadline">Headline</label></dt>
            <dd class="input-group-sm"
                ng-class="{ 'has-error' : postForm.title.$invalid && !postForm.title.$pristine }">
                <input id="postHeadline"
                       name="title"
                       type="text"
                       class="form-control"
                       placeholder="enter a headline for this post (required)"
                       ng-model="data.post.title"
                       ng-trim="false"
                       ng-minlength="1"
                       ng-maxlength="255"
                       required>

                <p ng-show="(postForm.short_description.$dirty && postForm.title.$invalid) ||
                            (postForm.title.$dirty && !postForm.title.$error.minlength &&
                            !postForm.title.$error.maxlength && postForm.title.$invalid)"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove"></span>
                    A headline for this post is required.
                </p>

                <p ng-show="postForm.title.$error.minlength" class="has-error">
                    <span class="glyphicon glyphicon-remove"></span>
                    Your headline is too short.
                </p>

                <p ng-show="postForm.title.$error.maxlength" class="has-error">
                    <span class="glyphicon glyphicon-remove"></span>
                    Your headline is too long.
                </p>
            </dd>
        </dl>

        <dl class="dl-horizontal">
          <dt><label for="slug">Slug</label></dt>
          <dd class="input-group-sm">
            <input name="slug"
                   ng-init="data.post.slug = data.post.slug || (data.post.title | slugify)"
                   placeholder="Unique slug to use in URLs (required)"
                   type="text"
                   class="form-control"
                   ng-model="data.post.slug"
                   ng-maxlength="255"
                   required>

            <p ng-show="postForm.slug.$error.unavailable" class="has-error">
               <span class="glyphicon glyphicon-remove"></span>
              This slug is already used by <a ui-sref="cortex.posts.edit({postId: data.postWithDuplicateSlug.id})">{{ data.postWithDuplicateSlug.title }}</a>
            </p>
          </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="postShortDesc">Description</label></dt>
            <dd class="input-group-sm"
                ng-class="{ 'has-error' : postForm.short_description.$invalid &&
                            !postForm.short_description.$pristine }">
                <input id="postShortDesc"
                       name="short_description"
                       type="text"
                       class="form-control"
                       placeholder="enter a short description about this post (required)"
                       ng-model="data.post.short_description"
                       ng-trim="false"
                       ng-minlength="25"
                       ng-maxlength="255"
                       required>

                <p ng-show="(postForm.author.$dirty && postForm.short_description.$invalid) ||
                            (postForm.short_description.$dirty && !postForm.short_description.$error.minlength &&
                            !postForm.short_description.$error.maxlength && postForm.short_description.$invalid)"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;A short description for this post is required.
                </p>
                <h5 ng-show="postForm.short_description.$valid"
                    class="text-right">
                    <em>
                        <small>{{255 - data.post.short_description.length}} characters left</small>
                    </em>
                </h5>
                <p ng-show="postForm.short_description.$error.minlength"
                   class="has-error"><span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;Your description is too short.
                </p>

                <p ng-show="postForm.short_description.$error.maxlength"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;Your description is too long.
                </p>
            </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="postAuthor">Author</label></dt>
            <dd class="input-group-sm"
                ng-class="{ 'has-error' : postForm.author.$invalid && !postForm.author.$pristine }">
                <input id="postAuthor"
                       name="author"
                       type="text"
                       class="form-control"
                       placeholder="enter an author for this post (required)"
                       ng-init="data.post.author = data.post.author || currentUser.fullname"
                       ng-model="data.post.author"
                       ng-minlength="1"
                       ng-maxlength="255"
                       required>

                <p ng-show="(postForm.copyright_owner.$dirty && postForm.author.$invalid) ||
                            (postForm.author.$invalid && !postForm.author.$pristine)"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;An author for this post is required.
                </p>

                <p ng-show="postForm.author.$error.maxlength"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;The author name is too long.
                </p>
            </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="postBody">Body</label></dt>
            <dd class="input-group-sm" id="dumb">
                <textarea id="postBody"
                          name="body"
                          class="form-control"
                          ng-model="data.post.body"
                          redactor="redactorOptions">

                </textarea>
            </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="postCopyright">Copyright Owner</label></dt>
            <dd class="input-group-sm"
                ng-class="{ 'has-error' : postForm.copyright_owner.$invalid && !postForm.copyright_owner.$pristine }">
                <input id="postCopyright"
                       name="copyright_owner"
                       type="text"
                       class="form-control"
                       placeholder="enter a copyright owner for this post (required)"
                       ng-model="data.post.copyright_owner"
                       ng-minlength="1"
                       ng-maxlength="255"
                       required>

                <p ng-show="(postForm.tag_list.$dirty && postForm.copyright_owner.$invalid) ||
                            (postForm.copyright_owner.$invalid && !postForm.copyright_owner.$pristine)"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;A copyright owner for this post is required.
                </p>

                <p ng-show="postForm.copyright_owner.$error.maxlength"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;The copyright owner name is too long.
                </p>
            </dd>
        </dl>
    </fieldset>

    <fieldset>
        <legend>SEO Information</legend>

        <dl class="dl-horizontal">
            <dt><label for="seoTitle">Title</label></dt>
            <dd class="input-group-sm">
                <input id="seoTitle"
                       name="seo_title"
                       type="text"
                       class="form-control"
                       placeholder="enter an HTML meta title for this post"
                       ng-model="data.post.seo_title"
                       ng-maxlength="255">

                <p ng-show="postForm.seo_title.$error.maxlength"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;Your seo title is too long.
                </p>
            </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="seoDescription">Description</label></dt>
            <dd class="input-group-sm">
                <input id="seoDescription"
                       name="seo_description"
                       type="text"
                       class="form-control"
                       placeholder="enter an HTML meta description for this post"
                       ng-model="data.post.seo_description"
                       ng-maxlength="255">

                <p ng-show="postForm.seo_description.$error.maxlength"
                   class="has-error">
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    &nbsp;Your seo description is too long.
                </p>
            </dd>
        </dl>

        <dl class="dl-horizontal">
            <dt><label for="seoPreview">Search Display Preview</label></dt>
            <dd class="input-group-sm">
                <textarea id="seoPreview"
                          name="seo_preview"
                          class="form-control"
                          rows="5"
                          disabled="disabled"
                          ng-model="data.post.seo_preview">

                </textarea>
            </dd>
        </dl>
    </fieldset>

    <fieldset>
        <legend>Publishing</legend>

        <dl class="dl-horizontal">
            <dt><label for="postPublishStatus">Status</label></dt>
            <dd class="input-group input-group-sm">
                <div id="postPublishStatus" name="draft" class="btn-group btn-group-sm">
                    <button name="draft"
                            type="button"
                            class="btn btn-default"
                            ng-model="data.post.draft"
                            btn-radio="true">
                        Draft
                    </button>
                    <button name="draft"
                            type="button"
                            class="btn btn-default"
                            ng-model="data.post.draft"
                            btn-radio="false">
                        Publish
                    </button>
                </div>
            </dd>
        </dl>
    </fieldset>

    <fieldset ng-if="!data.post.draft">
        <dl class="dl-horizontal">
            <dt><label for="postPublishScheduling">Publish Scheduling</label></dt>
            <dd class="input-group input-group-sm">
                <div id="postPublishScheduling" name="post_scheduling" class="btn-group btn-group-sm">
                    <button name="post_scheduling"
                            type="button"
                            class="btn btn-default"
                            ng-model="data.scheduled"
                            btn-radio="false"
                            ng-click="postScheduling.now()">
                        Now
                    </button>
                    <button name="post_scheduling"
                            type="button"
                            class="btn btn-default"
                            ng-model="data.scheduled"
                            btn-radio="true"
                            ng-click="postScheduling.scheduled()">
                        Schedule
                    </button>
                </div>
            </dd>
        </dl>

        <fieldset ng-if="data.scheduled">
            <dl class="dl-horizontal">
                <dt><label for="postPublishDate">Publish Date</label></dt>
                <dd class="input-group input-group-sm">
                    <div class="dropdown">
                        <a class="dropdown-toggle" id="postPublishDate" role="button" data-toggle="dropdown">
                            <div class="input-group input-group-sm">
                                <input name="published_at"
                                       type="text"
                                       class="form-control post-datetimepicker"
                                       ng-model="data.post.published_at"
                                       date-time-input="{{datetimepicker.format}}"
                                       placeholder="select an publish date and time"
                                        />
                                            <span class="input-group-btn">
                                                <button class="btn btn-default">
                                                    <span class="fa fa-calendar"></span>
                                                </button>
                                            </span>
                            </div>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            <datetimepicker ng-model="data.post.published_at"
                                            datetimepicker-config="{ dropdownSelector: '#postPublishDate' }">

                            </datetimepicker>
                        </ul>
                    </div>
                </dd>
            </dl>
        </fieldset>

        <fieldset ng-if="data.scheduled || !data.scheduled">
            <dl class="dl-horizontal">
                <dt><label for="postExpireDate">Expiration Date</label></dt>
                <dd class="input-group input-group-sm">
                    <div class="dropdown">
                        <a class="dropdown-toggle" id="postExpireDate" role="button" data-toggle="dropdown">
                            <div class="input-group input-group-sm">
                                <input name="expired_at"
                                       type="text"
                                       class="form-control post-datetimepicker"
                                       ng-model="data.post.expired_at"
                                       date-time-input="{{datetimepicker.format}}"
                                       placeholder="select an expiration date and time, or will not expire"
                                        />
                                            <span class="input-group-btn">
                                                <button class="btn btn-default">
                                                    <span class="fa fa-calendar"></span>
                                                </button>
                                            </span>
                            </div>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            <datetimepicker ng-model="data.post.expired_at"
                                            datetimepicker-config="{ dropdownSelector: '#postExpireDate' }">

                            </datetimepicker>
                        </ul>
                    </div>
                </dd>
            </dl>
        </fieldset>

        <dl class="dl-horizontal" ng-if="!data.post.draft">
            <dt></dt>
            <dd>
                <em>This post will be published to <strong>Advice &amp; Resources</strong>
                    <span ng-if="!data.scheduled"><strong> immediately</strong></span>
                                <span ng-if="data.scheduled && data.post.published_at"> on
                                    <strong> {{ data.post.published_at | date:'yyyy/MM/dd' }}</strong>
                                </span>
                    <span ng-if="!data.post.expired_at"> and will not expire.</span>
                                <span ng-if="data.post.expired_at">and will expire on
                                    <strong>{{ data.post.expired_at | date:'yyyy/MM/dd' }}.</strong>
                                </span>
                </em>
            </dd>
        </dl>
    </fieldset>
  </div>

  <div class="post-form-side input-group-sm">
      <fieldset>
          <legend>Career Phase</legend>

          <div class="input-group-sm" name="job_phase">
              <select name="job_phase"
                      class="form-control"
                      ng-model="data.post.job_phase"
                      ng-options="(phase | humanize) for phase in data.phases"
                      value="{{ phase }}"
                      required>
                  <option value="" selected> select a career phase for this post</option>
              </select>

              <p ng-show="!data.post.job_phase && postForm.$valid"
                 class="has-error">
                  <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                  &nbsp;A career phase for this post is required.
              </p>
          </div>

                  <span ng-if="data.jobPhaseCategories.length">
                      <legend>Categories</legend>

                      <div class="checkbox-list">
                          <div class="checkbox" ng-repeat="category in data.jobPhaseCategories">
                              <label>
                                  <input type="checkbox" ng-model="category.$selected">
                                  {{ category.name }}
                              </label>
                          </div>
                      </div>
                  </span>
      </fieldset>

      <fieldset>
          <legend>Post Tags</legend>

          <div name="postTags">
              <tags-input id="postTags"
                          name="postTags"
                          display-property="name"
                          type="text"
                          placeholder="enter the tags for this post"
                          ng-model="data.post.tag_list"
                          ng-maxlength="255"
                      >
                  <auto-complete source="loadTags($query)"></auto-complete>
              </tags-input>

              <p ng-show="postForm.tag_list.$error.maxlength"
                 class="has-error">
                  <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                  &nbsp;You've entered too many tags.
              </p>
              <div>
                  <span class="dropdown" on-toggle="toggled(open)">
                      <a href class="dropdown-toggle">Popular Tags</a>
                      <ul class="dropdown-menu">
                          <li ng-repeat="tag in data.popularTags">
                              <a ng-click="addTag(tag)">{{ tag.name }} <span class="pull-right">{{ tag.count }}</span></a>
                          </li>
                      </ul>
                  </span>
              </div>
          </div>
      </fieldset>

      <fieldset>
          <legend>Home Page Display</legend>

          <div class="btn-group" name="display">
              <button name="display"
                      type="button"
                      class="btn btn-default btn-sm"
                      ng-model="data.post.display"
                      btn-radio="'small'">
                  Small
              </button>
              <button name="display"
                      type="button"
                      class="btn btn-default btn-sm"
                      ng-model="data.post.display"
                      btn-radio="'medium'">
                  Medium
              </button>
              <button name="display"
                      type="button"
                      class="btn btn-default btn-sm"
                      ng-model="data.post.display"
                      btn-radio="'large'">
                  Large
              </button>
          </div>
          <p ng-show="!data.post.display && postForm.$valid"
             class="has-error">
              <span class="glyphicon glyphicon-remove form-control-feedback"></span>
              &nbsp;A display size for this post is required.
          </p>
      </fieldset>

      <fieldset>
          <legend>Featured Image</legend>

          <button type="button"
                  class="btn btn-primary btn-sm"
                  ng-model="data.post.featured_image_url">
              Browse...
          </button>

          <!-- here is a button that allows you to pick media from the media library,
          I suppose it would work similarly to the file upload control,
          but it's pulling from the library rather than your computer
          -->
      </fieldset>

      <fieldset>
          <legend>Discussion</legend>

          <div class="checkbox-list">
              <div class="checkbox">
                  <label>
                      <input type="checkbox" value="">
                      Allow comments
                  </label>
              </div>

              <div class="checkbox">
                  <label>
                      <input type="checkbox" value="">
                      Allow trackbacks and pings
                  </label>
              </div>
          </div>
      </fieldset>

      <fieldset>
          <legend>Admin Notes</legend>

          <textarea name="notes"
                    class="form-control vmargin-bottom-small"
                    rows="5" ng-model="data.post.notes">

          </textarea>

          <!--<legend>Statistics and Tracking</legend>-->
      </fieldset>
  </div>

  <div class="post-action-buttons">
      <fieldset>
          <legend></legend>
          <dl class="dl-horizontal">
              <dd class="input-group-sm">
                  <button type="submit"
                          class="btn btn-primary btn-sm"
                          ng-disabled="postForm.$invalid || !data.post.type || !data.post.job_phase || !data.post.display">
                      <span class="fa fa-cloud-upload"></span>
                      <span ng-if="data.post.draft && !data.post.scheduled">Save as Draft</span>
                      <span ng-if="!data.scheduled && !data.post.draft">Save and Publish Now</span>
                      <span ng-if="data.scheduled && !data.post.draft">Save and Schedule</span>
                  </button>

                  <button class="btn btn-sm">
                      <span class="fa fa-search"></span>
                      Preview
                  </button>
              </dd>
          </dl>
      </fieldset>
  </div>
</form>

<!-- Media popup -->
<ui-view/>
